---
- include: install.yml
- include: config.yml

- name: ensure goaccess is running
  service:
    name: "{{ goaccess_name }}"
    state: started
    enabled: "yes"

- include_role:
    name: traefik
  vars:
    file_config: "yes"
    label: "{{ goaccess_name }}"
    domain: "{{ goaccess_domain }}"
    ip_address: "{{ goaccess_http_listen_addr }}"
    http_port: "{{ goaccess_http_port }}"
    add_www: "{{ goaccess_add_www }}"
    add_path_prefixes: "{{ goaccess_add_path_prefixes }}"
    path_prefix_required: "yes"
    middlewares:
      - auth
  tags:
    - users
